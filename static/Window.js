// Generated by CoffeeScript 1.6.3
/* TODO:
* mode toggle
* status bar
* arrow keys cursor movement constrained by view text depending on mode
* lclick to place cursor
* lclick+drag to highlight
* double-lclick to highlight word
* triple-lclick to highlight line
*/

var Tab, Window;

Tab = require('./Tab');

module.exports = Window = (function() {
  function Window() {}

  Window.init = function(o) {
    Window.current_user = o.current_user;
    Window.tabs = [];
    Window._resize();
    Window.draw();
    Window.tabs = [
      new Tab({
        file: o != null ? o.file : void 0,
        x: 0,
        y: 0,
        w: Window.w,
        h: Window.h,
        active: true
      })
    ];
    return Window.mode = 'COMBO';
  };

  Window._resize = function() {
    Terminal.screen.w = process.stdout.columns;
    Terminal.screen.h = process.stdout.rows;
    Window.h = Terminal.screen.h - 1;
    return Window.w = Terminal.screen.w;
  };

  Window.resize = function() {
    var tab, _i, _len, _ref, _results;
    Logger.out("window caught resize " + process.stdout.columns + ", " + process.stdout.rows);
    Window._resize();
    Window.draw();
    _ref = Window.tabs;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      tab = _ref[_i];
      _results.push(tab.resize({
        w: Window.w,
        h: Window.h
      }));
    }
    return _results;
  };

  Window.draw = function() {
    Terminal.xbg(NviConfig.gutter_bg).clear_screen();
    return Window.clear_status_bar();
  };

  Window.keypress = function(ch, key) {
    Logger.out("caught keypress: " + JSON.stringify(arguments));
    if (!key) {
      return;
    }
    if (key.ctrl && key.name === 'c') {
      die('');
    }
    switch (key.name) {
      case 'escape':
        return 1;
      case 'left':
        return Window.current_cursor().move(-1);
      case 'right':
        return Window.current_cursor().move(1);
      case 'up':
        return Window.current_cursor().move(0, -1);
      case 'down':
        return Window.current_cursor().move(0, 1);
    }
  };

  Window.mousepress = function(e) {
    return Logger.out("caught mousepress: " + JSON.stringify(e));
  };

  Window.current_cursor = function() {
    var _ref, _ref1, _ref2;
    return (_ref = Window.active_tab) != null ? (_ref1 = _ref.active_view) != null ? (_ref2 = _ref1.cursors) != null ? _ref2[0] : void 0 : void 0 : void 0;
  };

  Window.set_status = function(s) {
    Window.clear_status_bar();
    Window.move_to_status_bar();
    Terminal.echo(s.substr(0, Terminal.screen.w)).clear_eol();
    return Window.current_cursor().move(0);
  };

  Window.clear_status_bar = function() {
    return Terminal.xbg(NviConfig.status_bar_bg).go(1, Terminal.screen.h).clear_eol();
  };

  Window.move_to_status_bar = function() {
    return Terminal.go(1, Terminal.screen.h).xbg(NviConfig.status_bar_bg).xfg(NviConfig.status_bar_fg);
  };

  return Window;

})();
