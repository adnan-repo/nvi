// Generated by CoffeeScript 1.6.3
var User, cleaned_up, cleanup, filename, keypress, nil, _ref;

global.NviConfig = require('../config.json');

global.Logger = require('./Logger');

global.Terminal = require('./Terminal');

global.delay = function(s, f) {
  return setTimeout(f, s);
};

global.interval = function(s, f) {
  return setInterval(f, s);
};

global.repeat = function(n, s) {
  var i, o, _i;
  o = '';
  for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {
    o += s;
  }
  return o;
};

cleaned_up = false;

cleanup = function() {
  if (cleaned_up) {
    return;
  }
  process.stdin.pause();
  Terminal.fg('reset').clear().go(1, 1).flush();
  return cleaned_up = true;
};

process.on('exit', cleanup);

global.die = function(err) {
  cleanup();
  if (err) {
    process.stderr.write(err + "\n");
    console.trace();
    process.exit(1);
  }
  process.stdout.write("see you soon!\n");
  return process.exit(0);
};

if (!process.stdout.isTTY) {
  die('must be in a tty');
}

keypress = require('keypress');

process.stdin.setRawMode(true);

keypress(process.stdin);

keypress.enableMouse(process.stdout);

process.on('exit', function() {
  return keypress.disableMouse(process.stdout);
});

process.stdin.setEncoding('utf8');

_ref = process.argv, nil = _ref[0], nil = _ref[1], filename = _ref[2];

User = require('./User');

global.Window = require('./Window');

Logger.out('init');

Window.init({
  current_user: new User(NviConfig.user),
  file: filename
});

process.stdout.on('resize', Window.resize);

process.stdin.on('keypress', Window.keypress);

process.stdin.on('mousepress', Window.mousepress);

process.stdin.resume();
